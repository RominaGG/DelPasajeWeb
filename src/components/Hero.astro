---
import { contentfulClient } from "../lib/contentful";

// Pedimos los datos a Contenful
// buscamos la entrada del tipo Homepage
const entries = await contentfulClient.getEntries({
    content_type: 'homepage',
    limit: 1,
});

// Desempaquetamos los datos
// si no encontramos nada (por error) usa un objeto vacio para qe no explote todo
const homeData = entries.items[0]?.fields || {};

//preparamos las variables con fallbacks por las dudas
const title = homeData.heroTitle || 'Del Pasaje';
const subtitle = homeData.heroSubtitle || 'Rock argentino nacido en el oeste.';

// manejo de multimedia del fondo
const rawImages = (homeData.heroBackground as any[])|| [];

// mapeamos la lista de las imagenes para saacar solo las urls limpias
let backgroundUrls = rawImages.map(img => 
    img.fields?.file?.url ? `https:${img.fields.file.url}` : null
).filter(url => url !== null);

// fallback si no cargamos nada en contenful usamos local de emergencia
if (backgroundUrls.length === 0) {
    backgroundUrls.push('/assets/img/galeria8.jpeg');
}

---


<section id="inicio" class="hero">

    <div class="hero-slider">

        {backgroundUrls.map((url, index) => (
            // primera imagen index 0, lleva active aara verse al inicio
            <img src={url} alt={ `Fondo Hero ${index}`}
                class={`slide-img ${index === 0 ? 'active' : ''}`}
            />
        ))}
        <!---  <img src="/assets/img/galeria9.jpeg" alt=""/>
        <img src="/assets/img/galeria10.jpeg" alt=""/>
        <img src="/assets/img/galeria8.jpeg" alt="foto">
        <img src="/assets/img/galeria11.jpeg" alt="">-->
    </div>

    <div class="hero-overlay"></div>
    <div class="hero-content">
        <h1 class="hero-title">{title}<span class="brand-mark">Â®</span></h1>

        <div class="hero-subtitle">
            <p>{subtitle}</p>
             
            </div>

        <a href="#fechas" class="hero-btn">
            Ver fechas
        </a>
    </div>
</section>

<script>

    // este corre en navegador para cambiar las fotos
    const slides = document.querySelectorAll('.slide-img');
    let currentSlide = 0;
    const slideInterval = 5000; // 5 segundos entre foto 

    // se activa si hay mas de una foto
    if (slides.length > 1 ) {
        setInterval(() => {
            // sacamos la clase active de la foto aactual
            slides[currentSlide].classList.remove('active');
            //calculo cual es la siguiente 
            currentSlide = (currentSlide + 1) % slides.length;
        
        // ponemos active a la siguiente foto
        slides[currentSlide].classList.add('active');
    }, slideInterval);
};

</script>


<style>
    .hero {
    position: relative;
    height: 80vh;
    min-height: 500px;
    overflow: hidden;
}

.hero-slider {
    position: absolute;
    inset: 0;
    z-index: 0;
}

.hero-slider .slide-img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
    
}

.hero-slider .slide-img.active {
    opacity: 1;
}

@keyframes heroFade {
    0% {opacity: 0;}
    10% {opacity: 1;}
    30% {opacity: 1;}
    40% {opacity: 0;}
    100% {opacity: 0;}
}

.hero-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1;
}

.hero-content {
    position: relative;
    z-index: 2;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 1rem;

}

.hero-title,
.hero-text {
    color: white;
}

.hero-title {
    font-size: clamp(3rem, 6vw, 5rem);
    font-family: var(--font-title);
    font-weight: 700;
    text-transform: uppercase;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
    letter-spacing: 3px;
}


.hero-text {
    margin-top: 0.5rem;
    max-width: 600px;
    font-size: 1.1rem;
    line-height: 1.6;
    opacity: 0.95;
    
    
}

.hero-text p {
    margin-top: 0.5rem;
}

.hero-btn {
    margin-top: 1.5rem;
    padding: 0.8rem 2rem;
    color: white;
    background: transparent;
    text-decoration: none;
    border: 1px solid white;
    text-transform: uppercase;
    font-size: 0.85rem;
    transition: background 0.3s;
}

.hero-btn:hover {
    background: white;
    color: black;
}

.brand-mark {
    font-size: 0.45rem;
    vertical-align: super;
    margin-left: 0.2rem;
    opacity: 0.8;
}
</style>